/*!
 * Lightweight URL manipulation with JavaScript
 * This library is independent of any other libraries and has pretty simple
 * interface and lightweight code-base.
 * Some ideas of query string parsing had been taken from Jan Wolter
 * @see http://unixpapa.com/js/querystring.html
 * @see https://github.com/Mikhus/domurl
 *
 * @license MIT
 * @author Mykhailo Stadnyk <mikhus@gmail.com>
 */
!function(ns){"use strict";var RX_PROTOCOL=/^[a-z]+:/,RX_PORT=/[-a-z0-9]+(\.[-a-z0-9])*:\d+/i,RX_CREDS=/\/\/(.*?)(?::(.*?))?@/,RX_WIN=/^win/i,RX_PROTOCOL_REPL=/:$/,RX_QUERY_REPL=/^\?/,RX_HASH_REPL=/^#/,RX_PATH=/(.*\/)/,RX_PATH_FIX=/^\/{2,}/,RX_SINGLE_QUOTE=/'/g,RX_DECODE_1=/%([ef][0-9a-f])%([89ab][0-9a-f])%([89ab][0-9a-f])/gi,RX_DECODE_2=/%([cd][0-9a-f])%([89ab][0-9a-f])/gi,RX_DECODE_3=/%([0-7][0-9a-f])/gi,RX_PLUS=/\+/g,RX_PATH_SEMI=/^\w:$/,RX_URL_TEST=/[^/#?]/;function urlConfig(url){var config={path:!0,query:!0,hash:!0};return url?(RX_PROTOCOL.test(url)&&(config.protocol=!0,config.host=!0,RX_PORT.test(url)&&(config.port=!0),RX_CREDS.test(url)&&(config.user=!0,config.pass=!0)),config):config}var isNode="undefined"==typeof window&&"undefined"!=typeof global&&"function"==typeof require,nodeRequire=isNode?ns.require:null,map={protocol:"protocol",host:"hostname",port:"port",path:"pathname",query:"search",hash:"hash"},defaultPorts={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},_currNodeUrl;function getCurrUrl(){return isNode?(_currNodeUrl||(_currNodeUrl="file://"+(process.platform.match(RX_WIN)?"/":"")+nodeRequire("fs").realpathSync(".")),_currNodeUrl):document.location.href}function parse(self,url,absolutize){var link,i,auth;url||(url=getCurrUrl()),isNode?link=nodeRequire("url").parse(url):(link=document.createElement("a")).href=url;var config=urlConfig(url);for(i in auth=url.match(RX_CREDS)||[],map)config[i]?self[i]=link[map[i]]||"":self[i]="";if(self.protocol=self.protocol.replace(RX_PROTOCOL_REPL,""),self.query=self.query.replace(RX_QUERY_REPL,""),self.hash=decode(self.hash.replace(RX_HASH_REPL,"")),self.user=decode(auth[1]||""),self.pass=decode(auth[2]||""),self.port=defaultPorts[self.protocol]==self.port||0==self.port?"":self.port,!config.protocol&&RX_URL_TEST.test(url.charAt(0))&&(self.path=url.split("?")[0].split("#")[0]),!config.protocol&&absolutize){var base=new Url(getCurrUrl().match(RX_PATH)[0]),basePath=base.path.split("/"),selfPath=self.path.split("/"),props=["protocol","user","pass","host","port"],s=props.length;for(basePath.pop(),i=0;i<s;i++)self[props[i]]=base[props[i]];for(;".."===selfPath[0];)basePath.pop(),selfPath.shift();self.path=("/"!==url.charAt(0)?basePath.join("/"):"")+"/"+selfPath.join("/")}self.path=self.path.replace(RX_PATH_FIX,"/"),self.paths(self.paths()),self.query=new QueryString(self.query)}function encode(s){return encodeURIComponent(s).replace(RX_SINGLE_QUOTE,"%27")}function decode(s){return(s=(s=(s=s.replace(RX_PLUS," ")).replace(RX_DECODE_1,(function(code,hex1,hex2,hex3){var n1=parseInt(hex1,16)-224,n2=parseInt(hex2,16)-128;if(0===n1&&n2<32)return code;var n3,n=(n1<<12)+(n2<<6)+(parseInt(hex3,16)-128);return n>65535?code:String.fromCharCode(n)}))).replace(RX_DECODE_2,(function(code,hex1,hex2){var n1=parseInt(hex1,16)-192;if(n1<2)return code;var n2=parseInt(hex2,16)-128;return String.fromCharCode((n1<<6)+n2)}))).replace(RX_DECODE_3,(function(code,hex){return String.fromCharCode(parseInt(hex,16))}))}function QueryString(qs){for(var parts=qs.split("&"),i=0,s=parts.length;i<s;i++){var keyVal=parts[i].split("="),key=decodeURIComponent(keyVal[0].replace(RX_PLUS," "));if(key){var value=void 0!==keyVal[1]?decode(keyVal[1]):null;void 0===this[key]?this[key]=value:(this[key]instanceof Array||(this[key]=[this[key]]),this[key].push(value))}}}function Url(url,noTransform){parse(this,url,!noTransform)}QueryString.prototype.toString=function(){var s="",e=encode,i,ii;for(i in this){var w=this[i];if(!(w instanceof Function||null===w))if(w instanceof Array){var len=w.length;if(len)for(ii=0;ii<len;ii++){var v=w[ii];s+=s?"&":"",s+=e(i)+(null==v?"":"="+e(v))}else s+=(s?"&":"")+e(i)+"="}else s+=s?"&":"",s+=e(i)+(void 0===w?"":"="+e(w))}return s},Url.prototype.clearQuery=function(){for(var key in this.query)this.query[key]instanceof Function||delete this.query[key];return this},Url.prototype.queryLength=function(){var count=0;for(var key in this.query)this.query[key]instanceof Function||count++;return count},Url.prototype.isEmptyQuery=function(){return 0===this.queryLength()},Url.prototype.paths=function(paths){var prefix="",i=0,s;if(paths&&paths.length&&paths+""!==paths){for(this.isAbsolute()&&(prefix="/"),s=paths.length;i<s;i++)paths[i]=!i&&RX_PATH_SEMI.test(paths[i])?paths[i]:encode(paths[i]);this.path=prefix+paths.join("/")}for(i=0,s=(paths=("/"===this.path.charAt(0)?this.path.slice(1):this.path).split("/")).length;i<s;i++)paths[i]=decode(paths[i]);return paths},Url.prototype.encode=encode,Url.prototype.decode=decode,Url.prototype.isAbsolute=function(){return this.protocol||"/"===this.path.charAt(0)},Url.prototype.toString=function(){return(this.protocol&&this.protocol+"://")+(this.user&&encode(this.user)+(this.pass&&":"+encode(this.pass))+"@")+(this.host&&this.host)+(this.port&&":"+this.port)+(this.path&&this.path)+(this.query.toString()&&"?"+this.query)+(this.hash&&"#"+encode(this.hash))},ns[ns.exports?"exports":"Url"]=Url}("undefined"!=typeof module&&module.exports?module:window);